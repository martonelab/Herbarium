knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(googlesheets)
library(here)
file <- "Master Collector Excel Templates_Kyra2019.xlsx"
original <- read_xlsx(here("./data/",file), sheet = s_num, skip = row_skip)
file <- "Master Collector Excel Templates_Kyra2019.xlsx"
s_num <- 1
row_skip <- 3
original <- read_xlsx(here("./data/",file), sheet = s_num, skip = row_skip)
#removes rows that are not specimens (ie NA)
df_na <- filter(original, !is.na(original$`Country`))
#removes rows that are not specimens (ie NA)
df_na <- filter(original, !is.na(original$`Country`))
View(original)
file <- "Master Collector Excel Templates_Kyra2019.xlsx"
s_num <- 2
row_skip <- 3
original <- read_xlsx(here("./data/",file), sheet = s_num, skip = row_skip)
#removes rows that are not specimens (ie NA)
df_na <- filter(original, !is.na(original$`Country`))
View(original)
row_skip <- 4
original <- read_xlsx(here("./data/",file), sheet = s_num, skip = row_skip)
#removes rows that are not specimens (ie NA)
df_na <- filter(original, str_detect(original$`Collector Number`, "PTM"))
View(df_na)
library(googlesheets)
#library(googlesheets4) # future will be googlesheets4
#(ptm <- drive_get("PTM - Master List"))
#need to authenticate (see popup window)
mysheets <- gs_ls()
gs_master <- gs_title("PTM - Master List")
#gets the data
gs_ptm<- gs_read(gs_master)
#cleans up columns
colnames(gs_ptm) <- gs_ptm[1,]
new <- gs_ptm[-c(1,2),]
df <- new %>%
mutate(no = paste0("PTM",`PTM#`)) %>%
filter(new$`PTM#` %in% df_na$`Collector Number`)
df <- new %>%
mutate(no = paste0("PTM",`PTM#`)) %>%
filter(new$`no` %in% df_na$`Collector Number`)
df <- new %>%
mutate(num = paste0("PTM",`PTM#`)) %>%
filter(num %in% df_na$`Collector Number`)
View(df)
df$`Final determination`
cbind(df$`Final determination`, df$`Determination in the field`)
cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`)
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`)
View(names)
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`))
df_nm#gs
df_nm$gs
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`, df_nm$gs)
if(df_nm$gs > 1){
higher <- classification(sp$sp, db="bold")
empty <- staff_a[FALSE,]
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
names(rect) <- c(species$rank)
rect["species"] <- str_split(rect["species"]," ")
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"],
Species = rect["species"][[1]][[2]])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
}
if(length(df_nm$gs) > 1){
higher <- classification(sp$sp, db="bold")
empty <- staff_a[FALSE,]
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
names(rect) <- c(species$rank)
rect["species"] <- str_split(rect["species"]," ")
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"],
Species = rect["species"][[1]][[2]])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
}
library(taxize)
higher <- classification(sp$sp, db="bold")
higher <- classification(df_nm$gs, db="bold")
higher
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`),
genus = str_split(gs," "))
genus
df_nm$genus
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`),
genus = str_split(gs," ")) %>%
separate(gs, c("Genus","Species"))
df_nm$Genus
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)) %>%
separate(gs, c("Genus","Species"))
higher <- classification(df_nm$gs, db="bold")
higher <- classification(df_nm$Genus, db="bold")
read_xlsx("Master-Collector-Excel-Templates-20190429.xlsx",2)
read_xlsx("Master-Collector-Excel-Templates-20190429.xlsx",sheet = 2, skip = 4)
collector_a <- read_xlsx("Master-Collector-Excel-Templates-20190429.xlsx",sheet = 2, skip = 4)
empty <- collector_a[FALSE,]
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
names(rect) <- c(species$rank)
rect["species"] <- str_split(rect["species"]," ")
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"],
Species = rect["species"][[1]][[2]])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
higher
View(higher)
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
print(species)
rect <- c(species$name)
print(rect)
names(rect) <- c(species$rank)
#rect["species"] <- str_split(rect["species"]," ")
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"],
Species = rect["species"][[1]][[2]])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
print(rect)
names(rect) <- c(species$rank)
#rect["species"] <- str_split(rect["species"]," ")
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"],
Species = rect["species"][[1]][[2]])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
higher[1]
higher[[1]]
sp <- higher[[1]]
sp$name
rect <- sp$name
rect
rect <- c(sp$name)
rect
names(rect <- sp$rank)
sp
sp$rank
names(rect) <- c(species$rank)
higher <- classification(df_nm$Genus, db="bold")
empty <- collector_a[FALSE,]
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
print(rect)
names(rect) <- c(species$rank)
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
higher <- classification(df_nm$Genus, db="bold")
View(empty)
View(empty)
View(empty)
View(empty)
empty <- collector_a[FALSE,]
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
names(rect) <- c(species$rank)
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
taxon <- empty
## select columns
herb=taxon %>%
select(`PTM#`, Herbarium, LabelQty, Phylum, Genus, )
meta <- new %>%
mutate(name = paste0("PTM", new$`PTM#`))%>%
filter(name %in% ptm$`Collector Number`) %>%
mutate(Herbarium = "UBC",
LabelQty = 1)
meta <- df %>%
mutate(Herbarium = "UBC",
LabelQty = 1)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, Phylum, Genus, )
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, Genus, )
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty)
View(gs_master)
View(taxon)
taxon <- cbind(df, empty$Phylum,empty$Class,empty$Genus,empty$Species)
meta <- taxon %>%
mutate(Herbarium = "UBC",
LabelQty = 1)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty,Phylum, Class,Genus, Species,)
meta$`empty$Phylum`
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty,empty$Phylum,empty$Class,empty$Genus,empty$Species)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty) %>%
cbind(empty$Phylum,empty$Class,empty$Genus,empty$Species)
herb
meta <- df_nm %>%
mutate(Herbarium = "UBC",
LabelQty = 1)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty) %>%
cbind(empty$Phylum,empty$Class,empty$Genus,empty$Species)
herb
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty) %>%
cbind(empty$Phylum,empty$Class,empty$Genus,species)
df_nm$Species
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty) %>%
cbind(empty$Phylum,empty$Class,empty$Genus,Species)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty) %>%
cbind(empty$Phylum,empty$Class,empty$Genus) %>%
select(Species)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty) %>%
cbind(empty$Phylum,empty$Class,empty$Genus) %>%
select(Species)
herb %>%
cbind(Species)
herb %>%
cbind(meta$Species)
meta <- df_nm %>%
mutate(Herbarium = "UBC",
LabelQty = 1) %>%
cbind(empty$Phylum,empty$Class,empty$Genus)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty,empty$Phylum,empty$Class,empty$Genus,Species)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, empty$Phylum, empty$Class, empty$Genus, Species)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, `empty$Phylum`, `empty$Class`, `empty$Genus`, Species)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, `empty$Phylum`, `empty$Class`, `empty$Genus`, Species)
herb
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`, df_nm$gs)
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`, df_nm$gs)
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`s)
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)) %>%
separate(gs, c("Genus","Species"))
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`, df_nm$gs)
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`)
names
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)) %>%
separate(gs, c("Genus","Species"))
help("separate")
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)) %>%
separate(gs, c("Genus","Species"), " ")
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`)
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)) %>%
separate(gs, c("Genus","Species"), " ")
# check
names <- cbind(df$`Final determination`, df$`Determination in the field`, df$`genetic match/notes`)
higher <- classification(df_nm$Genus, db="bold")
empty <- collector_a[FALSE,]
for(i in 1:length(higher)) {
if(!is.na(higher[i])) {
species <- higher[[i]]
rect <- c(species$name)
names(rect) <- c(species$rank)
empty <- empty %>%
add_row(Phylum = rect["phylum"],
Class = rect["class"],
Genus = rect["genus"])
}
else{empty <- empty %>%  add_row(Phylum = NA)}
}
meta <- df_nm %>%
mutate(Herbarium = "UBC",
LabelQty = 1) %>%
cbind(empty$Phylum,empty$Class,empty$Genus)
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, `empty$Phylum`, `empty$Class`, `empty$Genus`, Species)
herb
## select columns
herb <- meta %>%
select(`PTM#`, Herbarium, LabelQty, `empty$Phylum`, `empty$Class`, Genus, Species)
herb
meta <- df_nm %>%
mutate(Herbarium = "UBC",
LabelQty = 1,
Qualifier = "") %>%
cbind(empty$Phylum,empty$Class,empty$Genus)
help(get_classification)
itis <- classification(df_nm$Genus, db="itis")
itis
itis <- classification(df_nm$gs, db="itis")
itis <- classification(df_nm$gs, db="itis")
itis_2 <- classification(df_nm$Genus, db="itis")
itis_2 <- classification(df_nm$gs, db="itis")
df_nm$gs
df_nm <- df %>%
mutate(gs = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)) %>%
separate(gs, c("Genus","Species"), " ")
gs = choice) %>%
df_nm <- df %>%
mutate(choice = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`)
gs = choice) %>%
df_nm <- df %>%
mutate(choice = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`),
gs = choice) %>%
separate(gs, c("Genus","Species"), " ")
df_nm$choice
df_nm <- df %>%
mutate(choice = if_else(is.na(df$`Final determination`),
df$`Determination in the field`,
df$`Final determination`),
gs = choice) %>%
separate(choice, c("Genus","Species"), " ")
itis_2 <- classification(df_nm$gs, db="itis")
